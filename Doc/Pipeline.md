% 多周期处理器实验报告
% 庄永文 2013011208；郑奕辰 
% 2015.7

## 多周期处理器

### 实验目的
在单周期 MIPS  处理器的基础上，设计一个 5  级流水线的 MIPS  处理器。

### 设计方案

多周期处理器使用的UART、ALU等模块与单周期使用的相同。最大的区别是多周期的数据通路中间加了几级寄存器来实现多周期处理。

#### 整体设计：整体使用与教材《计算机组成与设计——硬件/软件接口》书中完全类似的设计，具体原理图如下：
<!-- ///这里要有原理图/  -->
在试验中将整个设计整体划分为四部分
* 各级之间流水线寄存器设计
* 冒险检测与转发设计
* 单周期代码的改写
* 中断处理设计
下面分别介绍各个部分的设计。

#### 各级之间流水线寄存器设计

级间寄存器主要就是各种锁存器。包括`IF.v` `IF2ID.v` `ID2EX.v` `EX2MEM.v` `MEM2WB.v` 等模块，基本上每个模块都是一个有`rst`和`clk`信号的锁存器，前面几个模块还会有`flush`输入信号用于阻塞和中断。

#### 冒险检测与转发设计
<!-- ///还没有写呢 -->

#### 单周期代码改写

#### 中断处理设计

我们的中断处理是在`ID`取指令阶段触发的，也就是说，保存到26号寄存器的PC值是运行到`ID`阶段的指令的PC值。因为如果直接写26号寄存器的话极有可能在写这个寄存器时另外的指令在`WB`阶段也要写寄存器，而这时无法避免同时无法解决的。因此我们的解决方案是在触发中断时将`ID`阶段取到的指令强行替换成`addi $26,$0,PC`这样的指令。然后再把所有级间寄存器的`flush`信号强行置零，同时关闭所有的转发(因为已经不需要进行转发了)。具体原理图如下
<!-- ///这里要有原理图 -->


### 思想体会
本次实验中中断处理应该是最麻烦也最难的环节了。在把冒险检测、转发设计、级间寄存器以及改写单周期代码都完成以后，
